# Query DSL
일래스틱 서치에서 json형식으로 쿼리를 작성할수 있는 인터페이스

## 쿼리 범주화

+ 기본쿼리 : 쿼리를 그룹핑해 분석 analyzed 방식또는 분석하지 않는 non-analyzed 방식으로 인덱스의 일부를 검색할수 있는 범주다.
기본쿼리 범주의 핵심은 기본쿼리 내에서 쿼리를 중첩할수 있다는 것이다. 기본쿼리로 term쿼리를 예로들수 있다.
+ 복합조회 : 쿼리에 여러쿼리 또는 필터를 조합할수 있는 그룹범주로서 , bool 또는 dismax 쿼리를 예로 들수 있다.
+ 분석하지 않는 쿼리 : 입력을 분석하지 않고 루씬 인덱스로 보내는 쿼리에 대한 범주다. 이러한 쿼리의 예는 term 쿼리다.
+ 전체 텍스트 검색 쿼리 : 전체 텍스트 검색을 지원하고, 해당 내용을 분석하며, 루씬 쿼리 문법을 제공하는 많은 쿼리 그룹이다. 이러한 쿼리의 예는 match 쿼리다.
+ 스코어 변경 쿼리 : 특히 전체 텍스트 검색과 결합해 사용할때 매우 중요한 쿼리 그룹이다. 스코어 변경 쿼리 그룹에는 쿼리 실행중 스코어 계산을 수정할 있는
쿼리가 포함된다. 예로 function_score쿼리가 있다.


### 기본쿼리
기본쿼리는 다른 쿼리를 전혀 그룹핑 할수 없는 쿼리다.

+ match: 주언진 입력을 분석할 수 있는 전체 텍스트 검색 쿼리가 필요할 때 하나의 쿼리(실제로는 여러타입이 포함된 쿼리)가 사용된다.
+ match_all : 일치하는 모든 도큐먼트를 찾는 간단한 쿼리로서, 집계할 때 리턴된 전체 인덱스의 텍스트가 필요한 상황에서 유용하다.
+ term : 간단하고 정확한 단어를 검색할 수있는 분석하지 않는 not analyzed 쿼리다.

### 복합 쿼리
복합 쿼리는 다른 쿼리와 함께 그룹핑하고 싶을 때 사용된다.

+ bool : 불린 논리 오퍼레이터를 포함해 여러 쿼리를 그룹핑할 수 있는 가장 일반적인 복합쿼리 중 하나다. 
bool 쿼리는 쿼리의 어느 부분이 일치해야 하는지, 어떤 부분이 일치하지 않아야 하는지를 제어할 수 있다.

### bool 쿼리의 이해
+ must : must 구문안에 작성된 쿼리가 일치할 때 도큐먼트를 리턴한다.
+ should : should 구문 내에 작성된 쿼리는 일치하거나 일치하지 않을 수 있지만, bool 쿼리 내에 must 구문이 없으면 도큐먼트를 
리턴하기 위해 적어도 하나 이상의 조건에 일치돼야 한다. (OR 개념)
+ must_not : must_not 구문이 포함된 쿼리는 일치하는 도큐먼트를 리턴하지 말아야 한다.
+ filter : filter 구문안에 있는 쿼리는 일치하는 도큐먼트를 보여줘야 한다. 그러나 스코어를 계산하지 않는다.

bool 쿼리의 구조는 다음과 같다.
```json
{
  "query" : {
    "bool" : {
      "must" : [{}],
      "should" : [{}],
      "must_not" : [{}],
      "filter" : [{}]
    }
  }
}  
```

### 분석하지 않는 쿼리
분석하지 않는 쿼리는 쿼리의 텍스트를 루씬 인덱스로 직접 전달한다.
즉 분석 과정의 완료 방법과 적절한 단어를 제공하는 방법을 정확하게 알고 있거나 분석하지 않는 필드를 검색해야 함을 의미한다.
일랙스틱서치를 **NoSQL저장소**로 사용할 계획이라면 아마도 분석하지 않는 쿼리 그룹을 사용할 것이다.
텍스트를 분석하지 않고, 즉 언어 분석기를 사용하기 때문에 정확한 단어를 찾는다.

+ term : term 쿼리는 특정 필드에서 특정값을 가진 도큐먼트를 비교하는 기능을 제공한다. 
예를 들어, 도큐먼트를 특정 태그(예제 데이터의 tags필드)와 일치시키려면 term 쿼리를 사용한다.

### 스코어 변경 쿼리
스코어 변경 쿼리는 검색 정확도와 연관성을 향상하는데 사용되는 쿼리 그룹이다.

예를 들어, 주어이진 지리적 지점에 가까운 도큐먼트의 스코어를 높이려면 function_socore 쿼리를 사용하면된다. 
