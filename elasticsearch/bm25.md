# 루씬에서 변경된 기본텍스트 스코어링: BM25
+ 스코어링(scoring)은 루씬에서 가장 중요한 부분이다.
+ 주어진 쿼리의 범위에서 도큐먼트의 스코어 속성을 계산하는 처리 과정이다.
+ 스코어(score)는 도큐먼트가 쿼리와 얼마나 잘 일치하는지를 설명하는 인자다.

## 정밀도와 회수
정밀도와 회수라는 두가지 매개변수를 사용해 검색이 얼마나 잘 수행되는지 측정할수 있다.

주어진 검색쿼리와 결과집합(검색 엔진에서 리턴된 도큐먼트)을 기반으로 정밀도와 회수는 다음과 같이 정의된다.

+ 정밀도(percision) : 검색된 관련 도큐먼트 개수와 검색된 도큐먼트 개수의 비율(연관성이 있거나 관련 없음). 백분율로 표시된다.
+ 회수(recall) : 검색된 관련 레코드 개수와 데이터베이스의 관련 레코드 개수의 비율, 백분율로 표시된다.

분석 단계에서 검색 엔지니어는 루씬 스코어링을 제어하고 회수를 향상할 수 있다.

## TF-IDF 정리
루씬 랭킹(ranking) 기능의 핵심이었던 TF-IDF는 `벡터공간모델` VSM, vector space model과 정보 검색의 `불린 모델` Boolean model의 조합으로 구축됐다.

루씬 접근 방식의 주요 아이디어는 전체 컬렉션에 단어가 나타나는 횟수와 관련해 쿼리 단어가 도큐먼트에 나타날수록 해당 도큐먼트가 쿼리와 연관성이 높다는 것이다.
또한 루씬은 불린 모델을 기반으로 쿼리 사양의 불린 논리를 사용해 스코어링돼야 하는 도큐먼트의 우선순위를 지정한다.

TF-IDF를 사용해 도큐먼트의 스코어를 계산하기 위해서는 다음을 포함한 여러 인자가 고려된다.

+ 단어빈도 term frequency : 주어진 단어가 도큐먼트에서 몇 번이나 나왔는지 설명하는 단어 기반의 인자다. 해당값은 다음과 같이 계산된다.
도큐먼트에 단어가 나타나는 횟수를 도큐먼트의 총 단어 개수로 나눈 값이다. 단어 빈도가 높을수록 도큐먼트의 스코어는 높아진다.
+ 역 도큐먼트 빈도 inverse document frequency : 주어진 단어가 얼마나 희귀한지 스코어링 계산식을 설명하는 단어 기반의 인자다.
역 도큐먼트의 빈도의 값이 높을 수록 단어는 더 희귀해진다. 스코어링 공식은 해당 인자를 사용해 드문 단어를 포함하는 도큐먼트의 부스트(boost)값을 올린다.
log_e(총 도큐먼트 수를 단어 t가 있는 도큐먼트 수로 나눈 값)로 계산된다.

로그를 수집할 때 IDF를 계산하는 동안 'the','that','is' 같은 단어가 너무 자주 나타날수 있기 때문에 이렇게 자주 나타나는 단어의 중요도를 낮추면서
희귀 단어의 중요도를 높여야 한다.

## BM25 스코어링 소개
루씬 6.0이 출시된 이래로 BM25는 기본 스코어링 방법이 됐다.

BM25는 확률적 연관성 모델에서 비롯됐지만 TF-IDF와 공통점이 많다.
두알고리즘 모두 단어빈도, 역도큐먼트 빈도, 필드길이 정규화라는 단어를 사용하지만 BM25와 TF-IDF에서 각 인자에 대한 정의는 조금 다르다.

BM25와 TF-IDF, 두 모델은 각 단어에 대한 가중치를 일부 IDF 함수와 일부 TF함수의 곱으로 정의한 다음 해당 단어의 가중치를 주어진 쿼리에 대한 전체
문서의 스코어로 요약한다.

#### 포화도(saturation)
포화도(saturation)는 주어진 도큐먼트에서 단어 빈도의 영향을 제한하는 매개변수로 설명된다.
포화도를 사용하면, 즉 매개변수 k를 미세 조정하면 단어 빈도의 영향을 조절할 수 있다.
단어 빈도의 제곱근에 대수 값을 곱해도 TF-IDF의 포화도 제한에는 경계가 없지만 도큐먼트에 나타나는 단어의 빈도가 높을수록 더 높은 가중치를 얻는다.
BM25는 k1포화도 매개변수를 포화도로 도입해 해당문제를 완전히 제거한다.

## BM25가 TF-IDF와 다른점
### 포화도 스코어
BM25는 k1 매개변수에 의해 제어되는 훨씬 더 강한 단어 포화도를 갖기 때문에 요청된 여러 쿼리 단어중 최소 1개 이상을 포함한 도큐먼트를 자연적으로 선호한다.
따라서 쿼리가 x또는 y이면  5개의 x와 1개의 y만 가진 특정 도큐먼트는 자연스럽게 1,000개의 x와 y가 전혀없는 첫 번째 도큐먼트보다 더 좋은 스코어를 얻는다.

### 평균 도큐먼트 길이
TF-IDF와 BM25의 두 번째 주요 차이점은 BM25에서 도큐먼트 길이를 사용한다는 점이다.

예를들어, 'travel'이라는 단어가 1,000개의 단어가 들어 있는 기사에서 한두번 나타난다면 여행에 관한 기사의 양은 거의 표시되지 않는다고 말할수 있지만
짧은 트윗에서 두번이나 'travel'이라는 단어가 나타난다는 것은 트윗에서 여행에 대한 많은 연관이 있음을 의미한다.
