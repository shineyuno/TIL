# 8.4 스프링의 기술
 스프링의 기술들은 스프링 프레임워크가 만들어진 진정한 목표인 POJO 기반의 엔터프라이즈 개발을 편리하게 해주는 도구일 뿐이다.
 
 스프링 사용자라면 스프링이 직접 제공하지 않는 기술에 대해서도 PSA를 적용할 줄 알아야 한다.
그것이 스프링의 목적과 개발 철학에 부합하는 스프링의 사용법이다.  
그래서 스프링의 기술들은 스프링의 목적과 핵심가치를 기준으로 살펴보고 이해하는 것이 중요하다.

## 8.4.1 제어의 역전(IoC) / 의존관계 주입(DI)
IoC/DI는 스프링의 가장 기본이 되는 기술이자 스프링의 핵심 개발 원칙이기도 하다.
나머지 두 가지 기술인  AOP와 PSA도 IoC/DI에 바탕을 두고 있다. 
3대기술은 아니지만 자주 등장하는 템플릿/콜백 패턴이 적용된 부분도 IoC/DI가 그 핵심 원리다.

이런 질문을 해볼수 있다. 왜 두개의 오브젝트를 분리해서 만들고, 인터페이스를 두고 느슨하게 연결한뒤,
실제 사용할 대상은 DI를 통해 외부에서 지정하는 것일까?
이렇게 DI방식으로 하는것이 그렇지 않은 경우, 즉 직접 자신이 사용할 오브젝트를 new 키워드로 생성해서 사용하는 강한 결합을 
쓰는 방법보다 나은점은 무엇일까?

 가장 간단한 답변은 '유연한 확장이 가능하게 하기 위해서'라고 할수 있다.
DI는 개방폐쇄 원칙 OCP 이라는 객체지향 설계 원칙으로 잘 설명될 수 있다. 
유연한 확장이라는 장점은 OCP의 '확장에는 열려 있다(개방)'에 해당한다. 
DI는 역시 OCP의 '변경에 닫혀있다(폐쇄)'라는 말로도 설명이 가능하다. 
폐쇄 관점에서 볼 때 장점은 '재사용이 가능하다'라고 볼수 있다.

A->B 라는 의존관계를 갖는 오브젝트 구조라고 생각해보자.
여기서 확장은 B가 자유롭게 변경될 수 있음을 의미한다. 이는 B가 변경돼도 A는 아무런 영향을 받지 않고 그대로 유지 가능하다는 뜻이기도 하다.
B관점에서는 유연한 확장이고 A관점으로 보자면 변경없이 재사용이 가능하다고 볼 수 있는 것이다.

B가 B1,B2,B3로 구현 방법이 바뀌어도 된다고 볼 수도 있고, B1,B2,B3처럼 의존 대상이 바뀌어도 A는 그대로 재사용이 가능하다고 볼수 있다.

### DI의 활용 방법
#### 핵심기능의 변경
 DI의 가장 대표적인 적용방법은 바로 의존 대상의 구현을 바꾸는 것이다. 
디자인 패턴의 전략 패턴이 대표적인 예다. A->B 구조에서 A의 기능 일부를 B에게 위임한다고 했을때 B의 구현 방식을 필요에 따라 통째로 B1,B2,B3로 바꾸는것이다.

예를 들어보면 서비스 오브젝트가 사용하는 DAO가 있다고 할때, DAO의 구현을 JDBC로 했다가, 그것을 JPA, 하이버네이트, JDO, iBatis등으로 변경하는 것을
생각할 수 있다. 

#### 핵심기능의 동적인 변경

#### 부가기능의 추가
DI의 세번째 활용 방법은 핵심기능은 그대로 둔 채로 부가기능을 추가하는 것이다.
데코레이션 패턴을 생각해보면 된다. 인터페이스를 두고 사용하게 하고, 실제 사용할 오브젝트는 외부에서 주입하는 DI를 적용해두면 데코레이터
패턴을 쉽게 적용할 수 있다. 그래서 핵심기능과 클라이언트 코드에는 전혀 영향을 주지 않으면서 부가적인 기능을 얼마든지 추가할 수 있다.

트랜잭션 기능을 부여했던 것이 그 대표적인 예다. 때로는 핵심기능은 그대로 둔채로 결과나 전달 파라미터를 조작할 수도 있고, 파라미터 리턴 결과를
활용해 로깅이나 보안 처리 같은 부가적인 작업을 수행할 수도 있다.

부가기능의 추가 방식을 특정 오브젝트가 아니라 좀 더 많은 대상으로 일반화해서 적용하면 AOP가 된다.

부가기능을 추가할 수 있는 것도 바로 DI덕분이다. DI 구조로 만들어 놨기 때문에 가능한 것이며 DI의 핵심 원칙은 OCP에도 충실하게 잘 들어맞는다.
OCP가 말하는 확장에 열려 있다는 것은 전략 패턴에서처럼 핵심기능을 변경해서 쓰는 수준만을 말하는게 아님을 기억해야 한다.

#### 인터페이스의 변경
PSA는 클라이언트가 일관성있게 사용할수 있는 인터페이스를 정의해주고 DI를 통해 어댑터 역할을 하는 오브젝트를 이용하게 해준다.

#### 프록시

#### 템플릿과 콜백

#### 싱글톤과 오브젝트 스코프
DI가 필요한 중요한 이유 중 한 가지는 DI할 오브젝트의 생명주기를 제어할 수 있다는 것이다.
DI를 프레임워크로 이용한다는건  DI 대상 오브젝트를 컨테이너가 관리한다는 의미다.
오브젝트의 생성부터 관계설정, 이용, 소멸에 이르기까지의 모든 과정을 DI 컨테이너가 주관하기 때문에 그 오브젝트의 스코프를 자유롭게 제어할 수 있다.

가장 기본이 되는 스코프는 역시 싱글톤이다.
하나 또는 소수의 오브젝트가 수많은 클라이언트를 상대로 고성능 서비스를 제공하는 방식은 엔터프라이즈 개발에서 매우 중요하다.
상태를 갖지 않도록 만든 오브젝트가 동시에 여러 스레드의 요청을 처리하는 이런 방식을 적용하려면, 만들어지는 오브젝트의 개수를 
제어하는 일이 매우 중요하다.

컨테이너가 오브젝트를 관리하는 IoC 방식이 유요하다. 스프링의 DI는 기본적으로 싱글톤으로 오브젝트를 만들어서 사용하게 한다.

#### 테스트
의존 오브젝트를 대신해서 스텁 또는 목 오브젝트 같은 테스트 대역을 활용해야 한다.
이때도 DI는 중요한 역할을 한다. DI를 위해 만든 수정자 메소드를 사용하면 테스트 코드 안에서 수동으로 목 오브젝트를 주입할 수 있다.
또는 테스트용으로 설정을 별도로 만드는 방법도 있다.

## 8.4.2 애스펙트 지향 프로그래밍(AOP)
IoC/DI를 이용해서 POJO에 선언적인 엔터프라이즈 서비스를 제공할 수 있지만 일부 서비스는 순순한 객체지향 기법만으로
POJO의 조건을 유지한 채로 적용하기 힘들다.
바로 이런 문제를 해결하기 위해 AOP가 필요하다. 스프링의 AOP는 스프링이 POJO 프로그래밍을 지원하려는 그 핵심 목적을 위해 중요한 역할을 하고 있다.

### AOP의 적용기법
#### 첫 번째는 스프링과 같이 다아내믹 프록시를 사용하는 방법이다.
이 방법은 기존 코드에 영향을 주지 않고 부가기능을 적용하게 해주는 데코레이터 패턴을 응용한 것이다.
부가기능을 부여할수 있는 곳은 메소드의 호출이 일어나는 지점뿐이라는 제약이 있다.

#### 두 번째는 자바 언의 한계를 넘어서는 언어의 확장을 이용하는 방법이다.
AspectJ라는 유명한 오픈소스 AOP툴이 있다.

### AOP의 적용단계
#### AOP 적용 1단계: 미리준비된 AOP 이용
스프링이 직접제공하는 대표적인 AOP는 바로 트랜잭션이다.

#### AOP 적용 2단계: 전담팀을 통한 정책 AOP적용
대표적으로 비즈니스 로직을 가진 오브젝트에 대한 보안, 특정 계층의 오브젝트의 이용 전후의 작업 기록을 남기는 로깅, 
데이터 추적을 위한 트레이싱, 특정구간의 실시간 성능 모니터링과 같은 정책적으로 적용할 만한 기능에 AOP를 이용하는 것이다.

#### AOP 적용 3단계: AOP의 자유로운 이용

## 8.4.3 포터블 서비스 추상화(PSA)
세 번째 가능 기술은 환경과 세부 기술의 변화에 관계없이 일관된 방식으로 기술에 접근
할수 있게 해주는 PSA (Portable Service Abstraction)
