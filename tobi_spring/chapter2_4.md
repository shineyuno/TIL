# 2.4 스프링 테스트 적용
애플리케이션 컨텍스트가 만들어질 때는 모든 싱글톤 빈 오브젝트를 초기화 한다.

## 2.4.1 테스트를 위한 애플리케이션 컨텍스트 관리
 스프링은 JUnit을 이용하는 테스트 컨텍스트 프레임워크를 제공한다. 
테스트 컨텍스트의 지원을 받으면 간단한 애노테이션 설정만으로 테스트에서 필요로 하는 애플리케이션
컨텍스트를 만들어서 모든 테스트가 공유하게 할 수 있다.

### 스프링 테스트 컨텍스트 프레임워크 적용
**스프링 테스트 컨텍스트를 적용한 UserDaoTest**

```java
@RunWith(SpringJUnit4ClassRunner.class) //스프링의 테스트 컨텍스트 프레임워크의 JUnit 확장기능 지정
@ContextConfiguration(location="/applicationContext.xml") // 테스트 컨텍스트가 자동으로 만들어줄 애플리케이션 컨텍스트의 위치 지정
public class UserDaoTest {

  @Autowired
  private ApplicationContext context; //테스트 오브젝트가 만들어지고 나면 스프링 테스트 컨텍스트에 의해 자동으로 값이 주입된다.
  ...
  
  @Before
  public void setUp(){
    this.dao = this.context.getBean("userDao",UserDao.class);
  }
  
}
```
JUnit은 테스트 메소드를 실행할 때마다 새로운 테스트 오브젝트를 만든다.

### 테스트 클래스의 컨텍스트 공유
 수백 개의 테스트 클래스를 만들었는데 모두 같은 설정파일을 사용한다고 해도 테스트 전체에 걸쳐 단 한 개의 애플리케이션 
 컨텍스트만 만들어져 사용된다.
 
 ### @Autowired
 @Autowired가 붙은 인스턴스 변수가 있으면, 테스트 컨텍스트 프레임워크는 변수 타입과 일치하는 컨텍스트 내의 빈을 찾는다.
 타입이 일치하는 빈이 있으면 인스턴스 변수에 주입해준다.
 별도의  DI 설정 없이 필드의 타입정보를 이용해 빈을 자동으로 가져올 수 있는데, 이런 방법을 타입에 의한 자동와이어링이라고 한다.
 스프링 애플리케이션 컨텍스트는 초기화할 때 자기 자신도 빈으로 등록한다.
 
 **UserDao를 직접 DI 받도록 만든 테스트
 
 ```java
 ...
 public void UserDaoTest {
  @Autowired
  UserDao dao; // userDao 타입 빈을 직접 DI 받는다.
 }
 ```
 
 @Autowired는 타입으로 가져올 빈 하나를 선택할 수 없는 경우에는 변수의 이름과 같은 이름의 빈이 있는지 확인한다.
 변수 이름으로도 빈을 찾을수 없는 경우에는 예외가 발생한다.
 
 
 ### @DirtiesContext 애노테이션
 테스트 컨텍스트는 이 애노테이션이 붙은 테스트 클래스에는 애플리케이션 컨텍스트 공유을 허용하지 않는다.
 테스트 메소드를 수행하고 나면 매번 새로운 애플리케이션 컨텍스트를 만들어서 다음 테스트가 사용하게 해준다.
 테스트중에 변경한 컨텍스트가 뒤의 테스트에 영향을 주지 않게 하기 위해서다.
