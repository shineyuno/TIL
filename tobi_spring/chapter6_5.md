# 6.5 스프링 AOP

## 6.5.1 자동 프록시 생성
프록시 팩토리 빈 방식의 접근 방법의 한계라고 생각했던 두가지 문제
- 부가기능이 타깃 오브젝트마다 새로 만들어지는 문제는 스프링 ProxyFactoryBean의 어드바이스를 통해 해결
- 남은것은 부가기능의 적용이 필요한 타깃 오브젝트마다 거의 비슷한 내용의 ProxyFactoryBean 빈 설정정보를 추가해주는 부분

### 중복 문제의 접근 방법
지금 까지 다뤄봤던 반복적이고 기계적인 코드에 대한 해결책
- JDBC API를 사용하는 DAO 코드 -> 메소드마다 JDBC try/catch/finally 블록으로 구성된 비슷한 코드가 반복 
-- 이 코드는 바뀌지 않는 부분과 바뀌는 부분을 구분해서 분리하고 . 템플릿과 콜백, 클라이언트로 나누는 방법을 통해 해결 ->전락패턴 과 DI 적용한덕분

- 좀 다른 방법으로 반복되는 코드의 문제 -> 반복적인 위임코드가 필요한 프록시 클래스 코드
-- 변하지 않는 타깃으로의 위임과 부가기능 적용 여부 판단이라는 부분은 코드 생성기법을 이용하는 다이내믹 프록시 기술에 맡기곡,
-- 변하는 부가기능 코드는 별도로 만들어서 다이내믹 프록시 생성 팩토리에 DI로 제공하는 방법을 사용
-- 의미있는 부가기능 로직인 트랜잭션 경계설정은 코드로 만들게 하고, 기계적인 코드인 타깃 인터페이스 구현과 위임, 부가기능 연동 부분은 자동생성하게


반복적인 ProxyFactoryBean 설정 문제는 설정 자동등록 기법으로 해결 할수 없을까?
일정한 타깃빈의 목록을 제공하면 자동으로 각 타깃 빈에 대한 프록시를 만들어주는 방법이 있다면 ProxyFactoryBean 타입 빈 설정을 
매번추가해서 프록시를 만들어내는 수고를 덜수 있을거 같다.

### 빈 후처리기를 이용한 자동 프록시 생성기
스프링은 컨테이너로서 제공하는 기능 중에서 변하지 않는 핵심적인 부분외에는 대부분 확장할 수 있도록 확장 포인트를 제공해준다.
그중에서 관심을 가질만한 확장포인트는 바로 BeanPostProcessor 인터페이스를 구현해서 만드는 빈 후처리기다.
빈 후처리기는 이름 그대로 스프링 빈 오브젝트로 만들어지고 난 후에, 빈 오브젝트를 다시 가공할 수 있게 해준다.

DefaultAdvisorAutoProxyCreator는 어드바이저를 이용한 자동 프록시 생성기인 빈 후처리기 이다.
스프링은 빈 후처리기가 빈으로 등록되어 있으면 빈 오브젝트가 생성될 때마다 빈후처리기에 보내서 후처리 작업을 요청한다.
빈후처리기는 빈 오브젝트의 프로퍼티를 강제로 수정할수도 있고 별도의 초기화 작업을 수행할 수도 있다.
심지어는 만들어진 빈 오브젝트를 자체를 바꿔치기할 수도 있다.
따라서 스프링이 설정을 참고해서 만든 오브젝트가 아닌 다른 오브젝트를 빈으로 등록시키는 것이 가능하다.
이를 잘 이용하면 스프링이 생성하는 빈 오브젝트의 일부를 프록시로 포장하고, 프록시를 빈으로 대신 등록할 수도 있다.
바로 이것이 자동 프록시 생성 빈 후처리기다.

빈으로 등록된 모든 어드바이저 내의 포인트컷을 이용해 전달받은 빈이 프록시 적용 대상인지 확인한다.
프록시 적용대상이면 그때는 내장된 프록시 생성기에게 현재 빈에 대한 프록시를 만들게 하고, 만들어진 프록시에 어드바이저를 연결해준다.
빈 후처리기는 프록시가 생성되면 원래 컨테이너가 전달해준 빈 오브젝트 대신 프록시 오브젝트를 컨테이너에게 돌려준다.
컨테이너는 최종적으로 빈 후처리기가 돌려준 오브젝트를 빈으로 등록하고 사용한다.

적용할 빈을 선정하는 로직이 추가된 포인트컷이 담긴 어드바이저를 등록하고 빈 후처리기를 사용하면 일일이 ProxyFactoryBean 빈을 등록하지
않아도 타깃 오브젝트에 자동으로 프록시가 적용되게 할수 있다. 
